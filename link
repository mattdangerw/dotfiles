#!/bin/bash -ex
# Symlinks all the actual locations these config files need to be in right back
# to this directory, so they can be easily version controlled.

SCRIPT_DIR=$(dirname $(readlink -f $0))

function backup_and_link() {
    mkdir -p $(dirname $2)
    # If its a symlink, just overwrite. Otherwise make a backup.
    if [ -e $2 -a ! -h $2 ]; then
        backup=${2}.old
        if [ -e $backup ]; then
            echo "$2 and $backup exist, clean up your shit"
            exit 1
        fi
        echo "Moving existing $2 to ${2}.old"
        mv $2 $backup
    fi
    ln -sTf $1 $2
}

function sudo_backup_and_link() {
    # If its a symlink, just overwrite. Otherwise make a backup.
    if [ -e $2 -a ! -h $2 ]; then
        backup=${2}.old
        if [ -e $backup ]; then
            echo "$2 and $backup exist, clean up your shit"
            exit 1
        fi
        echo "Moving existing $2 to ${2}.old"
        sudo mv $2 $backup
    fi
    sudo ln -sTf $1 $2
}

backup_and_link ${SCRIPT_DIR}/home/gitconfig ~/.gitconfig
backup_and_link ${SCRIPT_DIR}/home/gitignore ~/.gitignore
backup_and_link ${SCRIPT_DIR}/home/jshintrc ~/.jshintrc
backup_and_link ${SCRIPT_DIR}/home/npmrc ~/.npmrc
backup_and_link ${SCRIPT_DIR}/home/oh-my-zsh/custom/matt.zsh-theme ~/.oh-my-zsh/custom/matt.zsh-theme
backup_and_link ${SCRIPT_DIR}/home/tmux.conf ~/.tmux.conf
backup_and_link ${SCRIPT_DIR}/home/profile ~/.profile
backup_and_link ${SCRIPT_DIR}/home/quiltrc ~/.quiltrc
backup_and_link ${SCRIPT_DIR}/home/zshrc ~/.zshrc
backup_and_link ${SCRIPT_DIR}/home/hyper.js ~/.hyper.js
backup_and_link ${SCRIPT_DIR}/home/local/share/fonts ~/.local/share/fonts
