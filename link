#!/bin/bash -ex
# Symlinks all the actual locations these config files need to be in right back
# to this directory, so they can be easily version controlled.

SCRIPT_DIR=$(dirname $(readlink -f $0))

function backup_and_link() {
    mkdir -p $(dirname $2)
    # If its a symlink, just overwrite. Otherwise make a backup.
    if [ -e $2 -a ! -h $2 ]; then
        backup=${2}.old
        if [ -e $backup ]; then
            echo "$2 and $backup exist, clean up your shit"
            exit 1
        fi
        echo "Moving existing $2 to ${2}.old"
        mv $2 $backup
    fi
    ln -sTf $1 $2
}

function sudo_backup_and_link() {
    # If its a symlink, just overwrite. Otherwise make a backup.
    if [ -e $2 -a ! -h $2 ]; then
        backup=${2}.old
        if [ -e $backup ]; then
            echo "$2 and $backup exist, clean up your shit"
            exit 1
        fi
        echo "Moving existing $2 to ${2}.old"
        sudo mv $2 $backup
    fi
    sudo ln -sTf $1 $2
}

backup_and_link ${SCRIPT_DIR}/home/eos.modules ~/eos.modules
backup_and_link ${SCRIPT_DIR}/home/jhbuildrc ~/.jhbuildrc
backup_and_link ${SCRIPT_DIR}/home/git_template ~/.git_template
backup_and_link ${SCRIPT_DIR}/home/gitconfig ~/.gitconfig
backup_and_link ${SCRIPT_DIR}/home/gitignore ~/.gitignore
backup_and_link ${SCRIPT_DIR}/home/jshintrc ~/.jshintrc
backup_and_link ${SCRIPT_DIR}/home/matt.zsh-theme ~/.oh-my-zsh/custom/matt.zsh-theme
backup_and_link ${SCRIPT_DIR}/home/tmux.conf ~/.tmux.conf
backup_and_link ${SCRIPT_DIR}/home/profile ~/.profile
backup_and_link ${SCRIPT_DIR}/home/quiltrc ~/.quiltrc
backup_and_link ${SCRIPT_DIR}/home/zshrc ~/.zshrc
backup_and_link ${SCRIPT_DIR}/subl ~/.config/sublime-text-3/Packages/User
backup_and_link ${SCRIPT_DIR}/local/desktop-directories ~/.local/share/desktop-directories
backup_and_link ${SCRIPT_DIR}/local/logout.desktop ~/.local/share/applications/logout.desktop
backup_and_link ${SCRIPT_DIR}/local/restart.desktop ~/.local/share/applications/restart.desktop
backup_and_link ${SCRIPT_DIR}/local/shutdown.desktop ~/.local/share/applications/shutdown.desktop
backup_and_link ${SCRIPT_DIR}/local/fonts ~/.local/share/fonts
sudo_backup_and_link ${SCRIPT_DIR}/apt/obs-custom.list /etc/apt/sources.list.d/obs-custom.list
sudo_backup_and_link ${SCRIPT_DIR}/apt/obs-watson.pref /etc/apt/preferences.d/obs-custom.pref
