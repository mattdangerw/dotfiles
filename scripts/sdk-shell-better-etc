#!/bin/bash -ex

RUNTIME=$HOME/.local/share/flatpak/runtime/com.endlessm.Sdk/$(uname -m)/master/active/files

bwrap --bind $RUNTIME /usr \
      --bind $HOME $HOME \
      --ro-bind /sys/block /sys/block \
      --ro-bind /sys/bus /sys/bus \
      --ro-bind /sys/class /sys/class \
      --ro-bind /sys/dev /sys/dev \
      --ro-bind /sys/devices /sys/devices \
      --ro-bind /etc/passwd /etc/passwd \
      --ro-bind /etc/group /etc/group \
      --symlink /run/host/monitor/resolv.conf /etc/resolv.conf \
      --bind /etc/machine-id /etc/machine-id \
      --bind $RUNTIME/etc/services /etc/services \
      --bind $RUNTIME/etc/depmod.d /etc/depmod.d \
      --bind $RUNTIME/etc/wgetrc /etc/wgetrc \
      --bind $RUNTIME/etc/python /etc/python \
      --bind $RUNTIME/etc/ucf.conf /etc/ucf.conf \
      --bind $RUNTIME/etc/mailcap /etc/mailcap \
      --bind $RUNTIME/etc/hosts.deny /etc/hosts.deny \
      --bind $RUNTIME/etc/groff /etc/groff \
      --bind $RUNTIME/etc/pam.d /etc/pam.d \
      --bind $RUNTIME/etc/init.d /etc/init.d \
      --bind $RUNTIME/etc/fuse.conf /etc/fuse.conf \
      --bind $RUNTIME/etc/hosts.allow /etc/hosts.allow \
      --bind $RUNTIME/etc/ssh /etc/ssh \
      --bind $RUNTIME/etc/gtk-3.0 /etc/gtk-3.0 \
      --bind $RUNTIME/etc/nsswitch.conf /etc/nsswitch.conf \
      --bind $RUNTIME/etc/apache2 /etc/apache2 \
      --bind $RUNTIME/etc/subuid /etc/subuid \
      --bind $RUNTIME/etc/dhcp /etc/dhcp \
      --bind $RUNTIME/etc/mysql /etc/mysql \
      --bind $RUNTIME/etc/rpc /etc/rpc \
      --bind $RUNTIME/etc/gconf /etc/gconf \
      --bind $RUNTIME/etc/X11 /etc/X11 \
      --bind $RUNTIME/etc/modprobe.d /etc/modprobe.d \
      --bind $RUNTIME/etc/metrics /etc/metrics \
      --bind $RUNTIME/etc/deluser.conf /etc/deluser.conf \
      --bind $RUNTIME/etc/bash.bashrc /etc/bash.bashrc \
      --bind $RUNTIME/etc/modules-load.d /etc/modules-load.d \
      --bind $RUNTIME/etc/mke2fs.conf /etc/mke2fs.conf \
      --bind $RUNTIME/etc/mime.types /etc/mime.types \
      --bind $RUNTIME/etc/rc2.d /etc/rc2.d \
      --bind $RUNTIME/etc/ifplugd /etc/ifplugd \
      --bind $RUNTIME/etc/nanorc /etc/nanorc \
      --bind $RUNTIME/etc/dbus-1 /etc/dbus-1 \
      --bind $RUNTIME/etc/calendar /etc/calendar \
      --bind $RUNTIME/etc/modules /etc/modules \
      --bind $RUNTIME/etc/terminfo /etc/terminfo \
      --bind $RUNTIME/etc/vim /etc/vim \
      --bind $RUNTIME/etc/magic.mime /etc/magic.mime \
      --bind $RUNTIME/etc/selinux /etc/selinux \
      --bind $RUNTIME/etc/apm /etc/apm \
      --bind $RUNTIME/etc/tmpfiles.d /etc/tmpfiles.d \
      --bind $RUNTIME/etc/debian_version /etc/debian_version \
      --bind $RUNTIME/etc/hosts /etc/hosts \
      --bind $RUNTIME/etc/sysctl.d /etc/sysctl.d \
      --bind $RUNTIME/etc/ca-certificates /etc/ca-certificates \
      --bind $RUNTIME/etc/networks /etc/networks \
      --bind $RUNTIME/etc/dictionaries-common /etc/dictionaries-common \
      --bind $RUNTIME/etc/cron.weekly /etc/cron.weekly \
      --bind $RUNTIME/etc/apt /etc/apt \
      --bind $RUNTIME/etc/emacs /etc/emacs \
      --bind $RUNTIME/etc/dpkg /etc/dpkg \
      --bind $RUNTIME/etc/java-7-openjdk /etc/java-7-openjdk \
      --bind $RUNTIME/etc/adduser.conf /etc/adduser.conf \
      --bind $RUNTIME/etc/libnl-3 /etc/libnl-3 \
      --bind $RUNTIME/etc/xml /etc/xml \
      --bind $RUNTIME/etc/systemd /etc/systemd \
      --bind $RUNTIME/etc/python3 /etc/python3 \
      --bind $RUNTIME/etc/lighttpd /etc/lighttpd \
      --bind $RUNTIME/etc/pulse /etc/pulse \
      --bind $RUNTIME/etc/login.defs /etc/login.defs \
      --bind $RUNTIME/etc/openal /etc/openal \
      --bind $RUNTIME/etc/polkit-1 /etc/polkit-1 \
      --bind $RUNTIME/etc/insserv.conf.d /etc/insserv.conf.d \
      --bind $RUNTIME/etc/hostname /etc/hostname \
      --bind $RUNTIME/etc/bindresvport.blacklist /etc/bindresvport.blacklist \
      --bind $RUNTIME/etc/network /etc/network \
      --bind $RUNTIME/etc/wpa_supplicant /etc/wpa_supplicant \
      --bind $RUNTIME/etc/alternatives /etc/alternatives \
      --bind $RUNTIME/etc/rc1.d /etc/rc1.d \
      --bind $RUNTIME/etc/rmt /etc/rmt \
      --bind $RUNTIME/etc/sysctl.conf /etc/sysctl.conf \
      --bind $RUNTIME/etc/default /etc/default \
      --bind $RUNTIME/etc/rcS.d /etc/rcS.d \
      --bind $RUNTIME/etc/ld.so.cache /etc/ld.so.cache \
      --bind $RUNTIME/etc/gss /etc/gss \
      --bind $RUNTIME/etc/htdig /etc/htdig \
      --bind $RUNTIME/etc/udev /etc/udev \
      --bind $RUNTIME/etc/locale.conf /etc/locale.conf \
      --bind $RUNTIME/etc/python3.4 /etc/python3.4 \
      --bind $RUNTIME/etc/profile.d /etc/profile.d \
      --bind $RUNTIME/etc/subgid /etc/subgid \
      --bind $RUNTIME/etc/ghostscript /etc/ghostscript \
      --bind $RUNTIME/etc/ld.so.conf /etc/ld.so.conf \
      --bind $RUNTIME/etc/manpath.config /etc/manpath.config \
      --bind $RUNTIME/etc/issue.net /etc/issue.net \
      --bind $RUNTIME/etc/timezone /etc/timezone \
      --bind $RUNTIME/etc/cron.daily /etc/cron.daily \
      --bind $RUNTIME/etc/profile /etc/profile \
      --bind $RUNTIME/etc/update-motd.d /etc/update-motd.d \
      --bind $RUNTIME/etc/logrotate.d /etc/logrotate.d \
      --bind $RUNTIME/etc/udisks2 /etc/udisks2 \
      --bind $RUNTIME/etc/libaudit.conf /etc/libaudit.conf \
      --bind $RUNTIME/etc/host.conf /etc/host.conf \
      --bind $RUNTIME/etc/ld.so.conf.d /etc/ld.so.conf.d \
      --bind $RUNTIME/etc/lsb-release /etc/lsb-release \
      --bind $RUNTIME/etc/insserv /etc/insserv \
      --bind $RUNTIME/etc/securetty /etc/securetty \
      --bind $RUNTIME/etc/rc0.d /etc/rc0.d \
      --bind $RUNTIME/etc/avahi /etc/avahi \
      --bind $RUNTIME/etc/os-release /etc/os-release \
      --bind $RUNTIME/etc/iproute2 /etc/iproute2 \
      --bind $RUNTIME/etc/locale.alias /etc/locale.alias \
      --bind $RUNTIME/etc/rc5.d /etc/rc5.d \
      --bind $RUNTIME/etc/perl /etc/perl \
      --bind $RUNTIME/etc/highlight /etc/highlight \
      --bind $RUNTIME/etc/bash_completion.d /etc/bash_completion.d \
      --symlink /var/run/motd /etc/motd \
      --bind $RUNTIME/etc/ssl /etc/ssl \
      --bind $RUNTIME/etc/rc4.d /etc/rc4.d \
      --bind $RUNTIME/etc/libpaper.d /etc/libpaper.d \
      --bind $RUNTIME/etc/kernel /etc/kernel \
      --bind $RUNTIME/etc/.java /etc/.java \
      --bind $RUNTIME/etc/fstab /etc/fstab \
      --bind $RUNTIME/etc/usb_modeswitch.d /etc/usb_modeswitch.d \
      --bind $RUNTIME/etc/python2.7 /etc/python2.7 \
      --bind $RUNTIME/etc/inputrc /etc/inputrc \
      --bind $RUNTIME/etc/gshadow /etc/gshadow \
      --bind $RUNTIME/etc/UPower /etc/UPower \
      --bind $RUNTIME/etc/sgml /etc/sgml \
      --bind $RUNTIME/etc/drirc /etc/drirc \
      --bind $RUNTIME/etc/pam.conf /etc/pam.conf \
      --bind $RUNTIME/etc/geoclue /etc/geoclue \
      --bind $RUNTIME/etc/gdb /etc/gdb \
      --bind $RUNTIME/etc/ca-certificates.conf /etc/ca-certificates.conf \
      --bind $RUNTIME/etc/opt /etc/opt \
      --bind $RUNTIME/etc/environment /etc/environment \
      --bind $RUNTIME/etc/.pwd.lock /etc/.pwd.lock \
      --bind $RUNTIME/etc/kbd /etc/kbd \
      --bind $RUNTIME/etc/rc6.d /etc/rc6.d \
      --bind $RUNTIME/etc/locale.gen /etc/locale.gen \
      --symlink /proc/self/mounts /etc/mtab \
      --bind $RUNTIME/etc/shells /etc/shells \
      --bind $RUNTIME/etc/resolvconf /etc/resolvconf \
      --bind $RUNTIME/etc/debconf.conf /etc/debconf.conf \
      --bind $RUNTIME/etc/gai.conf /etc/gai.conf \
      --bind $RUNTIME/etc/fonts /etc/fonts \
      --bind $RUNTIME/etc/insserv.conf /etc/insserv.conf \
      --bind $RUNTIME/etc/sane.d /etc/sane.d \
      --bind $RUNTIME/etc/skel /etc/skel \
      --bind $RUNTIME/etc/binfmt.d /etc/binfmt.d \
      --bind $RUNTIME/etc/rc3.d /etc/rc3.d \
      --bind $RUNTIME/etc/shadow /etc/shadow \
      --bind $RUNTIME/etc/mailcap.order /etc/mailcap.order \
      --bind $RUNTIME/etc/ldap /etc/ldap \
      --bind $RUNTIME/etc/xdg /etc/xdg \
      --bind $RUNTIME/etc/init /etc/init \
      --bind $RUNTIME/etc/usb_modeswitch.conf /etc/usb_modeswitch.conf \
      --bind $RUNTIME/etc/issue /etc/issue \
      --bind $RUNTIME/etc/newt /etc/newt \
      --bind $RUNTIME/etc/gtk-2.0 /etc/gtk-2.0 \
      --bind $RUNTIME/etc/magic /etc/magic \
      --bind $RUNTIME/etc/protocols /etc/protocols \
      --bind $RUNTIME/etc/security /etc/security \
      --proc /proc \
      --dev /dev \
      --symlink /run /var/run \
      --symlink usr/lib /lib \
      --symlink usr/lib64 /lib64 \
      --symlink usr/bin /bin \
      --symlink usr/sbin /sbin \
      --dir /tmp \
      --dir /var/lib/dpkg \
      --dir /var/tmp \
      --dir /var/data \
      --dir /var/cache \
      --chdir $HOME/checkout \
      /bin/bash
